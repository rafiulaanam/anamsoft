generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
  CLIENT
}

enum LeadPriority {
  LOW
  MEDIUM
  HIGH
}

enum LeadStatus {
  NEW
  OPEN
  IN_PROGRESS
  ATTEMPTED_TO_CONTACT
  CONNECTED
  CONTACTED
  CALL_BOOKED
  APPOINTMENT_SCHEDULED
  QUALIFIED_TO_BUY
  CONTRACT_SENT
  OPEN_DEAL
  CLOSED_WON
  CLOSED_LOST
  UNQUALIFIED
  BAD_TIMING
  NOT_A_FIT
  WON
  LOST
}

enum ProjectStatus {
  PLANNING
  DESIGN
  DEVELOPMENT
  REVIEW
  DEPLOYED
  SUPPORT
}

// DEPRECATED / UNUSED (safe to remove later) — TODO 2025-12-14: Confirm no code depends on this before removing.
enum ProjectSourceType {
  MANUAL
  ESTIMATE
  AUDIT
}

enum MilestoneStatus {
  NOT_STARTED
  IN_PROGRESS
  DONE
}

enum FileType {
  FIGMA
  DOC
  CONTRACT
  INVOICE
  ASSET
  OTHER
}

enum DeploymentEnvironment {
  STAGING
  PRODUCTION
}

model User {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  name           String?
  email          String    @unique
  emailVerified  DateTime?
  image          String?
  hashedPassword String?
  role           Role      @default(USER)
  accounts       Account[]
  sessions       Session[]
}

model Account {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  userId             String   @db.ObjectId
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?
  oauth_token_secret String?
  oauth_token        String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken String   @unique
  userId       String   @db.ObjectId
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier String
  token      String   @unique
  expires    DateTime
  createdAt  DateTime @default(now())

  @@unique([identifier, token])
}

model PasswordResetToken {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
}

model Service {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  title            String
  slug             String   @unique
  shortDescription String
  description      String
  icon             String?
  imageUrl         String?
  startingPrice    Int?
  currency         String   @default("EUR")
  deliveryDaysMin  Int?
  deliveryDaysMax  Int?
  isActive         Boolean  @default(true)
  sortOrder        Int      @default(0)
  metaTitle        String?
  metaDescription  String?
  ogImageUrl       String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  deletedAt        DateTime?

  packages ServicePackage[]
  leads    Lead[] @relation("ServiceLeads")
}

model PortfolioItem {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  slug        String   @unique
  type        String
  description String
  imageUrl    String?
  demoUrl     String?
  isDemo      Boolean  @default(true)
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CaseStudy {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  industryLabel String
  summary       String
  coverImageUrl String?
  slug          String   @unique
  order         Int      @default(0)
  isPublished   Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Lead {
  id              String       @id @default(auto()) @map("_id") @db.ObjectId
  fullName        String?
  email           String
  phone           String?
  company         String?
  website         String?
  message         String
  source          String        @default("website_form")
  serviceInterest String?
  timeline        String?
  budgetRange     String?
  serviceId       String?       @db.ObjectId
  service         Service?      @relation("ServiceLeads", fields: [serviceId], references: [id], onDelete: SetNull)
  priority        LeadPriority  @default(MEDIUM)
  leadStatus      LeadStatus    @default(NEW)
  unread          Boolean       @default(true)
  assignedTo      String?
  lastContactedAt DateTime?
  nextFollowUpAt  DateTime?
  targetDeadline  DateTime?
  mustHaveFeatures Json?
  referenceSites   Json?
  decisionMaker    DecisionMaker @default(UNKNOWN)
  meetingAt        DateTime?
  meetingType      MeetingType?
  meetingLink      String?
  qualificationNotes String?
  decisionCriteriaNotes String?
  decisionProcessNotes String?
  paperProcessNotes String?
  championIdentified Boolean @default(false)
  competitionNotes String?
  bantBudgetConfirmed Boolean    @default(false)
  bantAuthorityConfirmed Boolean @default(false)
  bantNeedConfirmed Boolean      @default(false)
  bantTimelineConfirmed Boolean  @default(false)
  leadScore         Int          @default(0)
  disqualifyReason  String?
  disqualifyNote    String?
  score             Int          @default(0)
  spamScore         Int          @default(0)
  notes             String?
  attachments       Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  tags       LeadTagJoin[]
  activities LeadActivity[]
  projects   Project[] @relation("LeadProjects")

  @@index([leadStatus], map: "Lead_leadStatus_idx")
  @@index([nextFollowUpAt], map: "Lead_nextFollowUpAt_idx")
  @@index([unread], map: "Lead_unread_idx")
  @@index([createdAt], map: "Lead_createdAt_idx")
  @@index([source], map: "Lead_source_idx")
  @@index([priority], map: "Lead_priority_idx")
  @@index([assignedTo], map: "Lead_assignedTo_idx")
}

model LeadTag {
  id   String @id @default(auto()) @map("_id") @db.ObjectId
  name String @unique

  leads LeadTagJoin[]
}

model LeadTagJoin {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  leadId String @db.ObjectId
  tagId  String @db.ObjectId

  lead Lead @relation(fields: [leadId], references: [id], onDelete: Cascade)
  tag  LeadTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([leadId, tagId])
}

model LeadActivity {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  leadId    String   @db.ObjectId
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  type      String
  message   String
  metadata  Json?
  createdAt DateTime @default(now())
}

// DEPRECATED / UNUSED (safe to remove later) — TODO 2025-12-14: Remove if no legacy data requires it.
enum LeadBudgetRange {
  UNKNOWN
  UNDER_500
  BETWEEN_500_AND_1000 @map("_500_1000")
  BETWEEN_1000_AND_3000 @map("_1000_3000")
  BETWEEN_3000_AND_6000 @map("_3000_6000")
  ABOVE_6000 @map("_6000_PLUS")
}

enum DecisionMaker {
  UNKNOWN
  DECISION_MAKER
  INFLUENCER
  NEEDS_APPROVAL
}

enum MeetingType {
  CALL
  VIDEO
  IN_PERSON
}

model ServicePackage {
  id                    String    @id @default(auto()) @map("_id") @db.ObjectId
  serviceId             String    @db.ObjectId
  service               Service   @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  title                 String?
  priceFrom             Int?
  currency              String    @default("EUR")
  description           String?
  features              String[]  @default([])
  badge                 String?
  ctaLabel              String?
  ctaHref               String?
  isFeaturedOnLanding    Boolean   @default(false)
  deliveryDays          Int?
  isRecommended         Boolean   @default(false)
  isActive              Boolean   @default(true)
  sortOrder             Int       @default(0)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  deletedAt             DateTime?
}

model SiteConfig {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  heroTitle    String
  heroSubtitle String
  whatsapp     String?
  email        String
  heroPrimaryCtaLabel   String?
  heroPrimaryCtaLink    String?
  heroSecondaryCtaLabel String?
  heroSecondaryCtaLink  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Advanced settings
  sendAdminLeadEmails   Boolean  @default(true)
  sendClientLeadEmails  Boolean  @default(true)
  dailyLeadSummaryEmail Boolean  @default(false)

  autoFollowupEnabled Boolean @default(false)
  autoFollowupDays    Int     @default(3)
  markStaleAfterDays  Int     @default(14)

  defaultLocale        String  @default("en")
  secondaryLocale      String?
  showLanguageSwitcher Boolean @default(true)

  aiFeaturesEnabled    Boolean @default(false)
  aiDraftReplyEnabled  Boolean @default(false)
  sendDailySummaryEmails Boolean @default(false)
}

model Testimonial {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  subtitle    String?
  quote       String
  avatarUrl   String?
  rating      Int?
  sortOrder   Int      @default(0)
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Faq {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  question    String
  answer      String
  sortOrder   Int      @default(0)
  isPublished Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ProjectEstimate {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String
  salonName    String?
  websiteUrl   String?
  businessType String
  pagesNeeded  String
  bookingSetup String
  budgetRange  String
  timeline     String
  goals        String?
  notes        String?
  status       LeadStatus @default(NEW)
  createdAt    DateTime @default(now())
}

model WebsiteAudit {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String
  websiteUrl   String
  businessType String?
  mainGoal     String
  message      String?
  status       LeadStatus @default(NEW)
  notes        String?
  createdAt    DateTime @default(now())
}

model Project {
  id             String                 @id @default(auto()) @map("_id") @db.ObjectId
  name           String
  slug           String?
  clientName     String?
  clientEmail    String?
  leadId         String?                @db.ObjectId
  lead           Lead?                  @relation("LeadProjects", fields: [leadId], references: [id])
  status         ProjectStatus          @default(PLANNING)
  startDate      DateTime?
  deadline       DateTime?
  techStack      String[]
  repoUrl        String?
  stagingUrl     String?
  productionUrl  String?
  scopeSummary   String
  isArchived     Boolean                @default(false)
  archivedAt     DateTime?
  deletedAt      DateTime?
  deletedBy      String?
  deleteReason   String?
  sortOrder      Int                    @default(0)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt

  requirements   ProjectRequirement[]
  milestones     ProjectMilestone[]
  files          ProjectFile[]
  deployments    ProjectDeployment[]
  activities     ProjectActivity[]

  @@index([slug], map: "Project_slug_idx")
  @@index([deletedAt], map: "Project_deletedAt_idx")
  @@index([archivedAt], map: "Project_archivedAt_idx")
}

model ProjectRequirement {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  projectId  String   @db.ObjectId
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  group      String
  label      String
  isDone     Boolean  @default(false)
  sortOrder  Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ProjectMilestone {
  id         String          @id @default(auto()) @map("_id") @db.ObjectId
  projectId  String          @db.ObjectId
  project    Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  title      String
  dueDate    DateTime?
  status     MilestoneStatus @default(NOT_STARTED)
  sortOrder  Int             @default(0)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
}

model ProjectFile {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  projectId  String   @db.ObjectId
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  name       String
  url        String
  type       FileType
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ProjectDeployment {
  id           String                @id @default(auto()) @map("_id") @db.ObjectId
  projectId    String                @db.ObjectId
  project      Project               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  environment  DeploymentEnvironment
  versionTag   String?
  notes        String?
  deployedAt   DateTime              @default(now())
}

model ProjectActivity {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  projectId  String   @db.ObjectId
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  type       String
  message    String
  metadata   Json?
  createdAt  DateTime @default(now())
}

enum AmazonFulfillmentType {
  FBA
  FBM
}

enum AmazonProductStatus {
  PLANNING
  ACTIVE
  OUT_OF_STOCK
  DISCONTINUED
}

model Business {
  id          String            @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  legalName   String?
  type        String?
  country     String?
  state       String?
  city        String?
  registrationNumber String?
  taxId       String?
  notes       String?

  documents   BusinessDocument[]
  amazonProducts AmazonProduct[]

  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

model BusinessDocument {
  id          String    @id @default(auto()) @map("_id") @db.ObjectId

  business    Business  @relation(fields: [businessId], references: [id])
  businessId  String    @db.ObjectId

  title       String
  category    String
  storageUrl  String?
  fileKey     String?
  status      String?

  issueDate   DateTime?
  expiryDate  DateTime?
  notes       String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AmazonProduct {
  id          String                @id @default(auto()) @map("_id") @db.ObjectId

  business    Business              @relation(fields: [businessId], references: [id])
  businessId  String                @db.ObjectId

  sku         String
  asin        String?
  marketplace String?
  title       String

  fulfillmentType AmazonFulfillmentType
  status      AmazonProductStatus   @default(PLANNING)

  costPrice   Float?
  sellPrice   Float?
  currency    String?

  stockQty    Int?
  reorderLevel Int?

  notes       String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
